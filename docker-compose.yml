version: '3.8'

services:
  # MongoDB Database
  mongodb:
    image: mongo:7.0
    container_name: llm-nosql-mongodb
    restart: unless-stopped
    ports:
      - "27017:27017"
    environment:
      MONGO_INITDB_ROOT_USERNAME: admin
      MONGO_INITDB_ROOT_PASSWORD: adminpass
      MONGO_INITDB_DATABASE: test_db
    volumes:
      - mongodb_data:/data/db
      - ./datasets/mongodb_samples:/docker-entrypoint-initdb.d:ro
    networks:
      - nosql_network

  # Neo4j Graph Database (for Phase 4)
  neo4j:
    image: neo4j:5.14
    container_name: llm-nosql-neo4j
    restart: unless-stopped
    ports:
      - "7474:7474"  # HTTP
      - "7687:7687"  # Bolt
    environment:
      NEO4J_AUTH: neo4j/password123
      NEO4J_PLUGINS: '["apoc", "graph-data-science"]'
      NEO4J_dbms_security_procedures_unrestricted: apoc.*,gds.*
      NEO4J_dbms_memory_heap_initial__size: 512m
      NEO4J_dbms_memory_heap_max__size: 2G
    volumes:
      - neo4j_data:/data
      - neo4j_logs:/logs
    networks:
      - nosql_network
    profiles:
      - phase4  # Only start with: docker-compose --profile phase4 up

  # Redis Key-Value Store (for Phase 7)
  redis:
    image: redis:7.2-alpine
    container_name: llm-nosql-redis
    restart: unless-stopped
    ports:
      - "6379:6379"
    command: redis-server --appendonly yes --requirepass redispass123
    volumes:
      - redis_data:/data
    networks:
      - nosql_network

  # HBase (for Phase 7) - Using standalone mode
  hbase:
    image: dajobe/hbase:latest
    container_name: llm-nosql-hbase
    restart: unless-stopped
    ports:
      - "16010:16010"  # HBase Master Web UI
      - "9090:9090"    # Thrift API
      - "9095:9095"    # Thrift2 API
      - "2181:2181"    # Zookeeper
    environment:
      HBASE_CONF_hbase_rootdir: /hbase-data
      HBASE_CONF_hbase_zookeeper_quorum: localhost
    volumes:
      - hbase_data:/hbase-data
    networks:
      - nosql_network
    profiles:
      - phase6

  # Apache Jena Fuseki (RDF Triple Store) (for Phase 6)
  fuseki:
    image: stain/jena-fuseki:latest
    container_name: llm-nosql-fuseki
    restart: unless-stopped
    ports:
      - "3030:3030"
    environment:
      ADMIN_PASSWORD: admin123
      JVM_ARGS: -Xmx2g
    volumes:
      - fuseki_data:/fuseki
    networks:
      - nosql_network
    profiles:
      - phase6

volumes:
  mongodb_data:
  neo4j_data:
  neo4j_logs:
  redis_data:
  hbase_data:
  fuseki_data:

networks:
  nosql_network:
    driver: bridge
